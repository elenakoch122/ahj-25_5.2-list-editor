(()=>{"use strict";var t="";const e=t+"483a90b4efb01447790c.png",i=t+"57798b7b35698c09ce57.png";class s{constructor(t,e){this.name=t,this.price=e,this.id=performance.now()}static get markup(){return`\n    <div class="cell product-name"></div>\n    <div class="cell product-price"></div>\n    <div class="cell product-action">\n      <div class="product-action-wrap">\n        <img class="product-action-img edit" src="${e}" alt="Редактировать" title="Редактировать">\n      </div>\n      <div class="product-action-wrap">\n        <img class="product-action-img delete" src="${i}" alt="Закрыть" title="Закрыть">\n      </div>\n    </div>\n    `}create(){const t=document.createElement("div");t.classList.add("product"),t.setAttribute("data-id",this.id);const e=s.markup;return t.insertAdjacentHTML("beforeend",e),t.querySelector(".product-name").textContent=this.name,t.querySelector(".product-price").textContent=this.price,t}addToList(){this.element=this.create(),document.querySelector(".products").appendChild(this.element)}edit(){this.element.querySelector(".product-name").textContent=this.name,this.element.querySelector(".product-price").textContent=this.price}}class n{constructor(t,e){this.relatedEl=t,this.message=e,this.tooltipEl=this.create()}create(){const t=document.createElement("div");return t.classList.add("tooltip"),t.textContent=this.message,t}show(){this.relatedEl.parentElement.appendChild(this.tooltipEl);const{offsetTop:t,offsetLeft:e,offsetHeight:i}=this.relatedEl;this.tooltipEl.style.left=`${e}px`,this.tooltipEl.style.top=`${t+i+5}px`}remove(){this.tooltipEl.remove()}}class o{constructor(){this.tooltips=[],this.check=this.check.bind(this),this.onCheck=this.onCheck.bind(this)}static errors={name:{valueMissing:"Укажите наименование товара"},price:{valueMissing:"Укажите стоимость товара",typeMismatch:"Значение должно содержать только цифры",rangeUnderflow:"Допустимое значение 1 и более"}};static getError(t){const e=Object.keys(ValidityState.prototype).find((e=>{if("valid"!==e)return t.validity[e]?e:void 0}));if(e)return o.errors[t.name][e]}onCheck(t){this.check(t.target)}check(t){this.tooltips.forEach(((e,i,s)=>{e.relatedEl===t&&(e.remove(),s.splice(i,1))}));const e=o.getError(t);if(e){const i=new n(t,e);i.show(),this.tooltips.push(i)}}}class r{constructor(t){this.state=t,this.parentEl=document.querySelector(".widget"),this.element=this.create(),this.inputName=this.element.querySelector("#input-name"),this.inputPrice=this.element.querySelector("#input-price"),this.validator=new o,this.onButtonSave=this.onButtonSave.bind(this),this.onButtonCancel=this.onButtonCancel.bind(this)}static get markup(){return'\n    <div class="popup-block">\n      <label for="input-name">Наименование</label>\n      <input id="input-name" class="input" name="name" type="text" placeholder="Например, Samsung S3" required>\n    </div>\n\n    <div class="popup-block">\n      <label for="input-price">Стоимость</label>\n      <input id="input-price" class="input" name="price" type="number" placeholder="Например, 15000" required min="1">\n    </div>\n\n    <div class="popup-footer">\n      <button class="btn-popup btn-popup-save" type="submit">Сохранить</button>\n      <button class="btn-popup btn-popup-close" type="button">Отмена</button>\n    </div>\n    '}create(){const t=document.createElement("form");t.classList.add("popup"),t.setAttribute("novalidate","");const e=r.markup;return t.insertAdjacentHTML("beforeend",e),t}show(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.parentEl.appendChild(this.element);const e=this.element.querySelector(".btn-popup-close");this.inputArr=this.element.querySelectorAll(".input"),t&&(this.editProduct=this.state.products.find((e=>e.id===t)),this.inputName.value=this.editProduct.name,this.inputPrice.value=this.editProduct.price),e.addEventListener("click",this.onButtonCancel),this.inputArr.forEach((t=>t.addEventListener("input",this.validator.onCheck)))}hide(){this.inputName.value="",this.inputPrice.value="",this.editProduct=null,this.element.remove()}onButtonSave(t){if(t.target.checkValidity()){if(this.editProduct)this.editProduct.name=this.inputName.value,this.editProduct.price=Number(this.inputPrice.value),this.editProduct.edit();else{const t=new s(this.inputName.value,Number(this.inputPrice.value));t.addToList(),this.state.products.push(t)}this.hide()}else this.inputArr.forEach((t=>this.validator.check(t)))}onButtonCancel(){this.hide()}}class c{constructor(){this.products=[]}}const a=new class{constructor(t){this.storage=t}save(t){this.storage.setItem("products",JSON.stringify(t))}load(){try{return JSON.parse(this.storage.getItem("products"))}catch(t){throw new Error("Invalid state")}}}(localStorage),d=new class{constructor(t){this.widget=document.querySelector(".widget"),this.stateService=t,this.state=new c,this.popup=new r(this.state),this.showPopup=this.showPopup.bind(this),this.onSaveClick=this.onSaveClick.bind(this),this.onEditClick=this.onEditClick.bind(this),this.onDeleteClick=this.onDeleteClick.bind(this)}init(){this.addButton=document.querySelector(".btn-add"),this.addButton.addEventListener("click",this.showPopup),this.widget.addEventListener("submit",this.onSaveClick),this.widget.addEventListener("click",this.onEditClick),this.widget.addEventListener("click",this.onDeleteClick),window.addEventListener("beforeunload",(()=>{this.stateService.save(this.state)})),document.addEventListener("DOMContentLoaded",(()=>{const{products:t}=this.stateService.load();t.length>0&&this.drawProducts(t)}))}showPopup(){this.popup.show()}drawProducts(t){t.forEach((t=>{const e=new s(t.name,t.price);this.state.products.push(e),e.addToList()}))}onSaveClick(t){t.preventDefault(),this.popup.onButtonSave(t)}onEditClick(t){if(!t.target.classList.contains("edit"))return;const e=t.target.closest(".product"),i=Number(e.getAttribute("data-id"));this.popup.show(i)}onDeleteClick(t){if(!t.target.classList.contains("delete"))return;const e=t.target.closest(".product"),i=Number(e.getAttribute("data-id"));this.state.products=this.state.products.filter((t=>t.id!==i)),e.remove()}}(a);d.init()})();
//# sourceMappingURL=main.js.map